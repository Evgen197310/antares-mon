{% extends "base.html" %}

{% block title %}Адреса интерфейсов MikroTik{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <h1 class="mb-3"><i class="bi bi-hdd-network"></i> Адреса интерфейсов MikroTik</h1>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="h4 mb-0">{{ device_count }}</div>
        <small class="text-muted">Устройств</small>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="h4 mb-0">{{ interface_count }}</div>
        <small class="text-muted">Интерфейсов</small>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <div class="h4 mb-0">{{ address_count }}</div>
        <small class="text-muted">IP-адресов</small>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <a href="{{ url_for('vpn.mikrotik_topology') }}" class="btn btn-outline-primary w-100"><i class="bi bi-diagram-3"></i> Топология</a>
      </div>
    </div>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-6 mb-2">
    <input id="flt" class="form-control" placeholder="Фильтр: устройство / интерфейс / адрес / тип" />
  </div>
  <div class="col-md-6 mb-2 text-end">
    <a href="{{ url_for('main.index') }}" class="btn btn-light"><i class="bi bi-arrow-left"></i> На дашборд</a>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-sm table-hover align-middle" id="mt-table">
    <thead class="table-light">
      <tr>
        <th style="width: 28%">Устройство</th>
        <th style="width: 22%">Интерфейс</th>
        <th style="width: 35%">Адрес</th>
        <th style="width: 15%">Тип</th>
      </tr>
    </thead>
    <tbody>
      {% for r in routers %}
      <tr>
        <td>
          <a href="{{ url_for('vpn.interfaces', identity=r.identity) }}" class="text-decoration-none">{{ r.identity or '-' }}</a>
        </td>
        <td>{{ r.iface or '-' }}</td>
        <td><code>{{ r.ip or '-' }}</code></td>
        <td>{{ r.type or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
// Простой клиентский фильтр по всем ячейкам
const input = document.getElementById('flt');
const table = document.getElementById('mt-table');
if (input && table) {
  input.addEventListener('input', function() {
    const q = this.value.toLowerCase();
    for (const tr of table.tBodies[0].rows) {
      const txt = tr.innerText.toLowerCase();
      tr.style.display = txt.indexOf(q) >= 0 ? '' : 'none';
    }
  });
}
</script>
{% endblock %}
