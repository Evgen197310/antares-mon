# –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ Flask –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ VPN (IKEv2), RDP –∏ SMB –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### VPN –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (IKEv2)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö VPN —Å–µ—Å—Å–∏–π
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è VPN
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MikroTik —Ä–æ—É—Ç–µ—Ä–∞–º–∏

### RDP –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ RDP —Å–µ—Å—Å–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–µ—Å—Å–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### SMB –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –û—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ SSH
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

### REST API
- ‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π REST API –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ JSON endpoints –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
monitoring-web/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py              # –§–∞–±—Ä–∏–∫–∞ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ blueprints/              # –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vpn.py               # VPN –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rdp.py               # RDP –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ smb.py               # SMB –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.py               # REST API
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py          # –ú–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filters.py           # Jinja2 —Ñ–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ templates/               # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.html
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vpn/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rdp/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ smb/
‚îÇ   ‚îî‚îÄ‚îÄ static/                  # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ       ‚îú‚îÄ‚îÄ css/
‚îÇ       ‚îú‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ images/
‚îú‚îÄ‚îÄ requirements.txt             # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ run.py                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ README.md                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üåç –î–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ

- __–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –±–µ–∑ Nginx__: –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 5050 –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ/—Ñ–∞–µ—Ä–≤–æ–ª–µ –∏ –∑–∞–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É:
  - `http://<PUBLIC_IP>:5050/` –∏–ª–∏ `http://<DOMAIN>:5050/`
  - –ü—Ä–∏–º–µ—Ä—ã: `http://203.0.113.10:5050/`, `http://monitoring.example.com:5050/`

- __firewalld (RHEL/CentOS/Rocky)__:
```bash
sudo firewall-cmd --add-port=5050/tcp --permanent
sudo firewall-cmd --reload
```

- __ufw (Ubuntu/Debian)__:
```bash
sudo ufw allow 5050/tcp
sudo ufw reload
```

- __NAT/—Ä–æ—É—Ç–µ—Ä__: –ø—Ä–æ–±—Ä–æ—Å—å—Ç–µ –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 5050 –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Nginx –Ω–∞ 443 —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ 127.0.0.1:5050 (—Å–º. —Ä–∞–∑–¥–µ–ª Nginx). –¢–æ–≥–¥–∞ –≤—Ö–æ–¥ —Å–Ω–∞—Ä—É–∂–∏ –±—É–¥–µ—Ç –ø–æ `https://<DOMAIN>/` –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–æ—Ä—Ç–∞.

- __SELinux (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)__:
```bash
sudo setsebool -P httpd_can_network_connect 1   # –¥–ª—è Nginx-–ø—Ä–æ–∫—Å–∏
```

–ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Nginx –¥–æ—Å—Ç—É–ø–µ–Ω –í–µ–±‚ÄëUI:
```
–ì–ª–∞–≤–Ω–∞—è: http://<HOST>:5050/
VPN:     http://<HOST>:5050/vpn/
RDP:     http://<HOST>:5050/rdp/
SMB:     http://<HOST>:5050/smb/
API:     http://<HOST>:5050/api/
```

### Troubleshooting systemd/gunicorn

- __–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏__: `journalctl -u monitoring-web -n 200 -f`
- __–ü–æ—Ä—Ç –∑–∞–Ω—è—Ç__: –æ—Å–≤–æ–±–æ–¥–∏—Ç—å 5050, –ª–∏–±–æ —Å–º–µ–Ω–∏—Ç—å `FLASK_PORT` –≤ `/etc/default/monitoring-web` –∏ `systemctl restart monitoring-web`.
- __–ò–∑–º–µ–Ω–∏–ª–∏ unit/env –∏ –Ω–µ –≤–∏–¥–∏—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∞__: `systemctl daemon-reload` –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ unit, –∑–∞—Ç–µ–º `systemctl restart monitoring-web`.
- __–¢–∞–π–º–∞—É—Ç—ã –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö__: —É–≤–µ–ª–∏—á—å—Ç–µ `--timeout` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 180) –≤ `ExecStart` –∏/–∏–ª–∏ `proxy_read_timeout` –≤ nginx.
- __–ù–∞–≥—Ä—É–∑–∫–∞/–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å__: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —á–∏—Å–ª–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ `--workers` (–æ—Ä–∏–µ–Ω—Ç–∏—Ä: CPU*2) –∏ `--threads` (I/O-bound). –ü—Ä–∏–º–µ—Ä: `--workers 4 --threads 2`.
- __–ì—Ä–µ–π—Å—Ñ—É–ª –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫__: –¥–æ–±–∞–≤—å—Ç–µ –≤ unit `ExecReload=/bin/kill -HUP $MAINPID` –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `systemctl reload monitoring-web`.
- __–ü—É—Ç–∏/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è__: –∑–∞–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ `/etc/default/monitoring-web` (—Å–º. —Ä–∞–∑–¥–µ–ª Systemd). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `CONFIG_PATH` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–π JSON.
- __SELinux/AppArmor/Firewall__: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç –∏ –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º (`setenforce 0` –¥–ª—è —Ç–µ—Å—Ç–∞, –∑–∞—Ç–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `firewalld`/`iptables`.
- __–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏__: `curl -sS http://127.0.0.1:5050/health` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å 200.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.6+
- MySQL 5.7+ / MariaDB 10.2+
- SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º (–¥–ª—è SMB –º–æ–¥—É–ª—è)

### Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```
Flask==2.3.3
PyMySQL==1.1.0
paramiko==3.3.1
cryptography==41.0.4
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
cd /opt
git clone <repository> monitoring-web
cd monitoring-web
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `/etc/infra/config.json` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö:

```json
{
  "mysql": {
    "vpnstat": {
      "host": "localhost",
      "user": "vpn_user",
      "password": "password",
      "database": "vpnstat",
      "charset": "utf8mb4"
    },
    "rdpstat": {
      "host": "localhost", 
      "user": "rdp_user",
      "password": "password",
      "database": "rdpstat",
      "charset": "utf8mb4"
    },
    "smbstat": {
      "host": "localhost",
      "user": "smb_user", 
      "password": "password",
      "database": "smbstat",
      "charset": "utf8mb4"
    }
  },
  "ssh": {
    "smb_server": {
      "host": "smb.example.com",
      "user": "admin",
      "key_file": "/path/to/ssh/key"
    }
  }
}
```

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: vpnstat
```sql
CREATE TABLE session_history (
    username VARCHAR(255),
    outer_ip VARCHAR(45),
    inner_ip VARCHAR(45), 
    time_start DATETIME,
    time_end DATETIME,
    duration INT
);
```

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: rdpstat
```sql
CREATE TABLE rdp_active_sessions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255),
    session_id VARCHAR(255),
    domain VARCHAR(255),
    collection_name VARCHAR(255),
    remote_host VARCHAR(255),
    login_time DATETIME,
    connection_type VARCHAR(50),
    state INT,
    duration_seconds INT,
    notes TEXT
);

CREATE TABLE rdp_session_history (
    username VARCHAR(255),
    domain VARCHAR(255),
    collection_name VARCHAR(255),
    remote_host VARCHAR(255),
    login_time DATETIME,
    connection_type VARCHAR(50)
);
```

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: smbstat
```sql
CREATE TABLE smb_users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) UNIQUE
);

CREATE TABLE smb_files (
    id INT AUTO_INCREMENT PRIMARY KEY,
    path TEXT,
    norm_path TEXT
);

CREATE TABLE smb_clients (
    id INT AUTO_INCREMENT PRIMARY KEY,
    host VARCHAR(255)
);

CREATE TABLE active_smb_sessions (
    user_id INT,
    file_id INT,
    client_id INT,
    session_id VARCHAR(255),
    open_time DATETIME,
    last_seen DATETIME,
    initial_size BIGINT,
    FOREIGN KEY (user_id) REFERENCES smb_users(id),
    FOREIGN KEY (file_id) REFERENCES smb_files(id),
    FOREIGN KEY (client_id) REFERENCES smb_clients(id)
);

CREATE TABLE smb_session_history (
    user_id INT,
    file_id INT,
    open_time DATETIME,
    close_time DATETIME,
    initial_size BIGINT,
    final_size BIGINT,
    FOREIGN KEY (user_id) REFERENCES smb_users(id),
    FOREIGN KEY (file_id) REFERENCES smb_files(id)
);
```

## üöÄ –ó–∞–ø—É—Å–∫

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
python run.py
```

### –†–µ–∂–∏–º –ø—Ä–æ–¥–∞–∫—à–Ω (Gunicorn)
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± ‚Äî –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Gunicorn –∏ systemd. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ ‚Äî `wsgi.py`.

```bash
pip install gunicorn
# –õ–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ä—Ç –±–µ–∑ systemd (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
gunicorn --workers 3 --threads 2 --timeout 120 --bind 0.0.0.0:5050 wsgi:app
```

### Systemd —Å–µ—Ä–≤–∏—Å (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
1) –§–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è `/etc/default/monitoring-web`:
```bash
FLASK_PORT=5050
FLASK_HOST=0.0.0.0
FLASK_DEBUG=False
FLASK_TEMPLATES_AUTO_RELOAD=1
```

2) Unit-—Ñ–∞–π–ª `/etc/systemd/system/monitoring-web.service`:
```ini
[Unit]
Description=Monitoring Web Application (Flask via Gunicorn)
After=network.target

[Service]
User=root
Group=root
WorkingDirectory=/opt/monitoring-web
EnvironmentFile=-/etc/default/monitoring-web
ExecStart=/usr/bin/python3 -m gunicorn --workers 3 --threads 2 --timeout 120 --bind 0.0.0.0:${FLASK_PORT} wsgi:app
Restart=always
RestartSec=2
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

3) –ó–∞–ø—É—Å–∫ –∏ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞:
```bash
sudo systemctl daemon-reload
sudo systemctl enable monitoring-web
sudo systemctl restart monitoring-web
```

4) –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
systemctl status --no-pager -l monitoring-web
journalctl -u monitoring-web -n 200 -f
```

#### Graceful reload (–±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è)
–í unit-—Ñ–∞–π–ª –¥–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (—É –Ω–∞—Å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ):
```
ExecReload=/bin/kill -HUP $MAINPID
```
–ü–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
sudo systemctl daemon-reload
sudo systemctl reload monitoring-web   # –ø–µ—Ä–µ—á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
```

## üåê –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: `http://localhost:5050/`
- **VPN –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: `http://localhost:5050/vpn/`
- **RDP –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: `http://localhost:5050/rdp/`
- **SMB –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: `http://localhost:5050/smb/`

### REST API
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: `http://localhost:5050/api/`
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã**: `http://localhost:5050/api/health`
- **–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å**: `http://localhost:5050/api/status`

#### VPN API
- `GET /api/vpn/sessions` - –ê–∫—Ç–∏–≤–Ω—ã–µ VPN —Å–µ—Å—Å–∏–∏
- `GET /api/vpn/history?limit=100&offset=0&username=user` - –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π
- `GET /api/vpn/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ VPN

#### RDP API  
- `GET /api/rdp/sessions` - –ê–∫—Ç–∏–≤–Ω—ã–µ RDP —Å–µ—Å—Å–∏–∏
- `GET /api/rdp/history?limit=100&offset=0&username=user` - –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π
- `GET /api/rdp/user/<username>` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### SMB API
- `GET /api/smb/sessions` - –ê–∫—Ç–∏–≤–Ω—ã–µ SMB —Å–µ—Å—Å–∏–∏
- `GET /api/smb/files?limit=100&offset=0` - –û—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã
- `GET /api/smb/users?limit=100&offset=0` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ SMB
- `GET /api/smb/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ SMB

### –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
# –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ VPN —Å–µ—Å—Å–∏–∏
curl http://localhost:5050/api/vpn/sessions

# –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é RDP —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl "http://localhost:5050/api/rdp/history?username=john&limit=50"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
curl http://localhost:5050/api/health

# –ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
curl http://localhost:5050/api/status
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
export FLASK_ENV=production
export FLASK_DEBUG=0
export CONFIG_PATH=/etc/infra/config.json
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Flask
–í `app/config.py` –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:
- –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—É—Ç–∏ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–ß–µ—Ä–µ–∑ systemd/journalctl:
```bash
journalctl -u monitoring-web -n 200 -f
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ endpoint `/api/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
#!/bin/bash
response=$(curl -s http://localhost:8000/api/health)
status=$(echo $response | jq -r '.status')
if [ "$status" != "healthy" ]; then
    echo "ALERT: Monitoring system is $status"
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
fi
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —á–µ—Ä–µ–∑ firewall
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥–µ
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞** MySQL –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ó–∞—â–∏—Ç–∏—Ç–µ SSH –∫–ª—é—á–∏** –¥–ª—è SMB –º–æ–¥—É–ª—è
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS —Å nginx (–ø—Ä–∏–º–µ—Ä)
```nginx
server {
    listen 443 ssl;
    server_name monitoring.example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    add_header X-Frame-Options SAMEORIGIN always;
    add_header X-Content-Type-Options nosniff always;
    add_header Referrer-Policy no-referrer-when-downgrade;
    add_header X-XSS-Protection "1; mode=block";

    # –°–∂–∞—Ç–∏–µ
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ gunicorn
    location / {
        proxy_pass http://127.0.0.1:5050;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 180s;
        proxy_connect_timeout 5s;
        proxy_send_timeout 60s;
    }

    # Health-check (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    location /health {
        proxy_pass http://127.0.0.1:5050/health;
        access_log off;
    }
}
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL
mysql -h localhost -u vpn_user -p vpnstat -e "SELECT 1"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
mysql -u root -p -e "SHOW GRANTS FOR 'vpn_user'@'localhost'"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSH (SMB –º–æ–¥—É–ª—å)
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh -i /path/to/key user@smb.example.com "echo 'Connection OK'"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∫–ª—é—á
chmod 600 /path/to/ssh/key
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
export FLASK_DEBUG=1
python run.py
```

## üìù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- **Blueprints**: –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å (VPN, RDP, SMB, API) - –æ—Ç–¥–µ–ª—å–Ω—ã–π blueprint
- **Templates**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç `base.html`
- **Database**: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Filters**: Jinja2 —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
1. –°–æ–∑–¥–∞–π—Ç–µ blueprint –≤ `app/blueprints/`
2. –î–æ–±–∞–≤—å—Ç–µ —à–∞–±–ª–æ–Ω—ã –≤ `app/templates/`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ blueprint –≤ `app/__init__.py`
4. –î–æ–±–∞–≤—å—Ç–µ API endpoints –≤ `app/blueprints/api.py`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
python test_app.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python -m py_compile app/*.py app/blueprints/*.py
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/health` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

**–í–µ—Ä—Å–∏—è**: 2.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-08-08
